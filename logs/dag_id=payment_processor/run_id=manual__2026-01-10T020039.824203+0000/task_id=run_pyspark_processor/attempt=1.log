[2026-01-10T02:00:43.021+0000] {local_task_job_runner.py:123} INFO - ::group::Pre task execution logs
[2026-01-10T02:00:43.034+0000] {taskinstance.py:2613} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: payment_processor.run_pyspark_processor manual__2026-01-10T02:00:39.824203+00:00 [queued]>
[2026-01-10T02:00:43.040+0000] {taskinstance.py:2613} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: payment_processor.run_pyspark_processor manual__2026-01-10T02:00:39.824203+00:00 [queued]>
[2026-01-10T02:00:43.041+0000] {taskinstance.py:2866} INFO - Starting attempt 1 of 2
[2026-01-10T02:00:43.053+0000] {taskinstance.py:2889} INFO - Executing <Task(BashOperator): run_pyspark_processor> on 2026-01-10 02:00:39.824203+00:00
[2026-01-10T02:00:43.059+0000] {standard_task_runner.py:72} INFO - Started process 98 to run task
[2026-01-10T02:00:43.062+0000] {standard_task_runner.py:104} INFO - Running: ['***', 'tasks', 'run', 'payment_processor', 'run_pyspark_processor', 'manual__2026-01-10T02:00:39.824203+00:00', '--job-id', '7', '--raw', '--subdir', 'DAGS_FOLDER/payment_batch_dag.py', '--cfg-path', '/tmp/tmp82aoku8s']
[2026-01-10T02:00:43.064+0000] {standard_task_runner.py:105} INFO - Job 7: Subtask run_pyspark_processor
[2026-01-10T02:00:43.118+0000] {task_command.py:467} INFO - Running <TaskInstance: payment_processor.run_pyspark_processor manual__2026-01-10T02:00:39.824203+00:00 [running]> on host 80ad3deece0a
[2026-01-10T02:00:43.396+0000] {taskinstance.py:3132} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='benas' AIRFLOW_CTX_DAG_ID='payment_processor' AIRFLOW_CTX_TASK_ID='run_pyspark_processor' AIRFLOW_CTX_EXECUTION_DATE='2026-01-10T02:00:39.824203+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='manual__2026-01-10T02:00:39.824203+00:00'
[2026-01-10T02:00:43.397+0000] {logging_mixin.py:190} INFO - Task instance is in running state
[2026-01-10T02:00:43.398+0000] {logging_mixin.py:190} INFO -  Previous state of the Task instance: queued
[2026-01-10T02:00:43.400+0000] {logging_mixin.py:190} INFO - Current task name:run_pyspark_processor state:running start_date:2026-01-10 02:00:43.035499+00:00
[2026-01-10T02:00:43.400+0000] {logging_mixin.py:190} INFO - Dag name:payment_processor and current dag run status:running
[2026-01-10T02:00:43.401+0000] {taskinstance.py:731} INFO - ::endgroup::
[2026-01-10T02:00:43.403+0000] {subprocess.py:78} INFO - Tmp dir root location: /tmp
[2026-01-10T02:00:43.404+0000] {subprocess.py:88} INFO - Running command: ['/usr/bin/bash', '-c', 'cd /opt/***/payment_processor && python process_transactions.py']
[2026-01-10T02:00:43.416+0000] {subprocess.py:99} INFO - Output:
[2026-01-10T02:00:45.241+0000] {subprocess.py:106} INFO - 26/01/10 02:00:45 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
[2026-01-10T02:00:45.418+0000] {subprocess.py:106} INFO - Setting default log level to "WARN".
[2026-01-10T02:00:45.420+0000] {subprocess.py:106} INFO - To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).
[2026-01-10T02:00:49.581+0000] {subprocess.py:106} INFO - 26/01/10 02:00:49 WARN MetricsConfig: Cannot locate configuration: tried hadoop-metrics2-s3a-file-system.properties,hadoop-metrics2.properties
[2026-01-10T02:01:42.348+0000] {subprocess.py:106} INFO - [Stage 0:>                                                          (0 + 1) / 1]                                                                                [Stage 7:>                                                          (0 + 1) / 1]                                                                                [Stage 23:>                                                         (0 + 1) / 1]                                                                                [Stage 45:>                                                         (0 + 3) / 3][Stage 45:===================>                                      (1 + 2) / 3][Stage 45:======================================>                   (2 + 1) / 3]                                                                                26/01/10 02:01:42 WARN AbstractS3ACommitterFactory: Using standard FileOutputCommitter to commit work. This is slow and potentially unsafe.
[2026-01-10T02:01:42.954+0000] {subprocess.py:106} INFO - 26/01/10 02:01:42 WARN AbstractS3ACommitterFactory: Using standard FileOutputCommitter to commit work. This is slow and potentially unsafe.
[2026-01-10T02:01:48.085+0000] {subprocess.py:106} INFO - [Stage 60:>                                                         (0 + 1) / 1]                                                                                26/01/10 02:01:48 WARN AbstractS3ACommitterFactory: Using standard FileOutputCommitter to commit work. This is slow and potentially unsafe.
[2026-01-10T02:01:48.814+0000] {subprocess.py:106} INFO - 26/01/10 02:01:48 WARN AbstractS3ACommitterFactory: Using standard FileOutputCommitter to commit work. This is slow and potentially unsafe.
[2026-01-10T02:01:53.725+0000] {subprocess.py:106} INFO - [Stage 70:>                                                         (0 + 1) / 1]                                                                                26/01/10 02:01:53 WARN AbstractS3ACommitterFactory: Using standard FileOutputCommitter to commit work. This is slow and potentially unsafe.
[2026-01-10T02:01:54.258+0000] {subprocess.py:106} INFO - 26/01/10 02:01:54 WARN AbstractS3ACommitterFactory: Using standard FileOutputCommitter to commit work. This is slow and potentially unsafe.
[2026-01-10T02:01:59.074+0000] {subprocess.py:106} INFO - [Stage 75:>                                                         (0 + 1) / 1]                                                                                26/01/10 02:01:59 WARN AbstractS3ACommitterFactory: Using standard FileOutputCommitter to commit work. This is slow and potentially unsafe.
[2026-01-10T02:01:59.653+0000] {subprocess.py:106} INFO - 26/01/10 02:01:59 WARN AbstractS3ACommitterFactory: Using standard FileOutputCommitter to commit work. This is slow and potentially unsafe.
[2026-01-10T02:07:34.909+0000] {subprocess.py:106} INFO - [Stage 80:>                                                         (0 + 1) / 1][Stage 80:>                                                         (0 + 1) / 1][Stage 80:>                                                         (0 + 1) / 1][Stage 80:>                                                         (0 + 1) / 1][Stage 80:>                                                         (0 + 1) / 1][Stage 80:>                                                         (0 + 1) / 1]                                                                                ============================================================
[2026-01-10T02:07:34.914+0000] {subprocess.py:106} INFO - PAYMENTCHAIN TRANSACTION PROCESSOR (S3)
[2026-01-10T02:07:34.918+0000] {subprocess.py:106} INFO - ============================================================
[2026-01-10T02:07:34.919+0000] {subprocess.py:106} INFO - Spark Version: 3.5.0
[2026-01-10T02:07:34.920+0000] {subprocess.py:106} INFO - Input Bucket: s3a://***-paymentchain-dev-ben
[2026-01-10T02:07:34.921+0000] {subprocess.py:106} INFO - Output Bucket: s3a://***-paymentchain-output-ben
[2026-01-10T02:07:34.923+0000] {subprocess.py:106} INFO - ============================================================
[2026-01-10T02:07:34.924+0000] {subprocess.py:106} INFO - 
[2026-01-10T02:07:34.924+0000] {subprocess.py:106} INFO - [1/7] Loading data from S3...
[2026-01-10T02:07:34.925+0000] {subprocess.py:106} INFO - Intentando leer: s3a://***-paymentchain-dev-ben/exchange_rates.json
[2026-01-10T02:07:34.926+0000] {subprocess.py:106} INFO - Esquema: StructType([StructField('currency', StringType(), True), StructField('last_update', StringType(), True), StructField('rate', DoubleType(), True)])
[2026-01-10T02:07:34.927+0000] {subprocess.py:106} INFO - Count: 5
[2026-01-10T02:07:34.927+0000] {subprocess.py:106} INFO - +--------+-----------+------+
[2026-01-10T02:07:34.928+0000] {subprocess.py:106} INFO - |currency|last_update|  rate|
[2026-01-10T02:07:34.929+0000] {subprocess.py:106} INFO - +--------+-----------+------+
[2026-01-10T02:07:34.929+0000] {subprocess.py:106} INFO - |     EUR| 2024-01-01|   1.0|
[2026-01-10T02:07:34.930+0000] {subprocess.py:106} INFO - |     USD| 2024-01-01|  0.85|
[2026-01-10T02:07:34.931+0000] {subprocess.py:106} INFO - |     GBP| 2024-01-01|  1.15|
[2026-01-10T02:07:34.932+0000] {subprocess.py:106} INFO - |     JPY| 2024-01-01|0.0065|
[2026-01-10T02:07:34.933+0000] {subprocess.py:106} INFO - |     CHF| 2024-01-01|  0.95|
[2026-01-10T02:07:34.934+0000] {subprocess.py:106} INFO - +--------+-----------+------+
[2026-01-10T02:07:34.934+0000] {subprocess.py:106} INFO - 
[2026-01-10T02:07:34.935+0000] {subprocess.py:106} INFO -   ✅ Transactions loaded: 50000 rows
[2026-01-10T02:07:34.936+0000] {subprocess.py:106} INFO -   ✅ Merchants loaded: 100 rows
[2026-01-10T02:07:34.936+0000] {subprocess.py:106} INFO -   ✅ Fraud rules loaded
[2026-01-10T02:07:34.937+0000] {subprocess.py:106} INFO - 
[2026-01-10T02:07:34.938+0000] {subprocess.py:106} INFO - [2/7] Data validation and cleaning...
[2026-01-10T02:07:34.938+0000] {subprocess.py:106} INFO -   - Invalid transactions filtered: 2558
[2026-01-10T02:07:34.939+0000] {subprocess.py:106} INFO -   - Valid transactions: 47442
[2026-01-10T02:07:34.940+0000] {subprocess.py:106} INFO - 
[2026-01-10T02:07:34.940+0000] {subprocess.py:106} INFO - [3/7] Enrichment (joins with merchants and rates)...
[2026-01-10T02:07:34.941+0000] {subprocess.py:106} INFO -   - Joined with merchants
[2026-01-10T02:07:34.942+0000] {subprocess.py:106} INFO -   - Joined with exchange rates
[2026-01-10T02:07:34.942+0000] {subprocess.py:106} INFO -   - Enriched transactions: 47442
[2026-01-10T02:07:34.943+0000] {subprocess.py:106} INFO - 
[2026-01-10T02:07:34.944+0000] {subprocess.py:106} INFO - [4/7] Applying transformations...
[2026-01-10T02:07:34.945+0000] {subprocess.py:106} INFO -   - Transformations applied
[2026-01-10T02:07:34.945+0000] {subprocess.py:106} INFO - 
[2026-01-10T02:07:34.946+0000] {subprocess.py:106} INFO - [5/7] Fraud detection (window functions)...
[2026-01-10T02:07:34.947+0000] {subprocess.py:106} INFO -   - Suspicious transactions detected: 47205
[2026-01-10T02:07:34.948+0000] {subprocess.py:106} INFO - 
[2026-01-10T02:07:34.949+0000] {subprocess.py:106} INFO - [6/7] Generating reports (aggregations)...
[2026-01-10T02:07:34.949+0000] {subprocess.py:106} INFO -   - Currency report generated
[2026-01-10T02:07:34.950+0000] {subprocess.py:106} INFO -   - Category report generated
[2026-01-10T02:07:34.951+0000] {subprocess.py:106} INFO -   - Top merchants report generated
[2026-01-10T02:07:34.951+0000] {subprocess.py:106} INFO - 
[2026-01-10T02:07:34.952+0000] {subprocess.py:106} INFO - [7/7] Writing outputs to S3...
[2026-01-10T02:07:34.953+0000] {subprocess.py:106} INFO -   ✅ Processed transactions saved to s3a://***-paymentchain-output-ben/processed/transactions
[2026-01-10T02:07:34.954+0000] {subprocess.py:106} INFO -   ✅ Currency report saved
[2026-01-10T02:07:34.954+0000] {subprocess.py:106} INFO -   ✅ Category report saved
[2026-01-10T02:07:34.955+0000] {subprocess.py:106} INFO -   ✅ Top merchants report saved
[2026-01-10T02:07:34.956+0000] {subprocess.py:106} INFO -   ✅ Fraud alerts saved
[2026-01-10T02:07:34.957+0000] {subprocess.py:106} INFO - 
[2026-01-10T02:07:34.957+0000] {subprocess.py:106} INFO - ============================================================
[2026-01-10T02:07:34.958+0000] {subprocess.py:106} INFO - ✅ PROCESSING COMPLETED SUCCESSFULLY
[2026-01-10T02:07:34.959+0000] {subprocess.py:106} INFO - ============================================================
[2026-01-10T02:07:34.959+0000] {subprocess.py:106} INFO - Outputs available in: s3a://***-paymentchain-output-ben
[2026-01-10T02:07:34.960+0000] {subprocess.py:106} INFO - ============================================================
[2026-01-10T02:07:35.352+0000] {subprocess.py:110} INFO - Command exited with return code 0
[2026-01-10T02:07:35.378+0000] {taskinstance.py:340} INFO - ::group::Post task execution logs
[2026-01-10T02:07:35.379+0000] {taskinstance.py:352} INFO - Marking task as SUCCESS. dag_id=payment_processor, task_id=run_pyspark_processor, run_id=manual__2026-01-10T02:00:39.824203+00:00, execution_date=20260110T020039, start_date=20260110T020043, end_date=20260110T020735
[2026-01-10T02:07:35.390+0000] {logging_mixin.py:190} INFO - Task instance in success state
[2026-01-10T02:07:35.391+0000] {logging_mixin.py:190} INFO -  Previous state of the Task instance: running
[2026-01-10T02:07:35.392+0000] {logging_mixin.py:190} INFO - Dag name:payment_processor queued_at:2026-01-10 02:00:39.835456+00:00
[2026-01-10T02:07:35.393+0000] {logging_mixin.py:190} INFO - Task hostname:80ad3deece0a operator:BashOperator
[2026-01-10T02:07:35.426+0000] {local_task_job_runner.py:266} INFO - Task exited with return code 0
[2026-01-10T02:07:35.449+0000] {taskinstance.py:3895} INFO - 1 downstream tasks scheduled from follow-on schedule check
[2026-01-10T02:07:35.451+0000] {local_task_job_runner.py:245} INFO - ::endgroup::
